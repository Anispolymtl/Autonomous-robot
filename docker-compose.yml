version: "3.9"

x-shared-env: &shared-env
  APP_ENV: ${APP_ENV:-development}
  NODE_ENV: ${APP_ENV:-development}

services:
  app:
    build:
      context: .
      dockerfile: docker/Dockerfile.gateway
      args:
        APP_ENV: ${APP_ENV:-development}
        USER_ID: ${UID:-1000}
        GROUP_ID: ${GROUP_ID:-1000}
    image: myproj/app:humble
    container_name: app
    environment:
      <<: *shared-env
      ROS_DISTRO: humble
      ROS_DOMAIN_ID: "42"
      DISPLAY: ${DISPLAY}
      WS: /project_ws
      PORT: ${SERVER_PORT:-3000}
    volumes:
      - ./project_ws:/project_ws
      - /tmp/.X11-unix:/tmp/.X11-unix:ro
    network_mode: host

  client:
    build:
      context: .
      dockerfile: docker/Dockerfile.client
      args:
        APP_ENV: ${APP_ENV:-development}
        USER_ID: ${UID:-1000}
        GROUP_ID: ${GROUP_ID:-1000}
    image: myproj/client:latest
    container_name: web-client
    depends_on:
      - app
    environment:
      <<: *shared-env
      CLIENT_PORT: ${CLIENT_PORT:-4200}
    ports:
      - "${CLIENT_PORT:-4200}:${CLIENT_PORT:-4200}"
